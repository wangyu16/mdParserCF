<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Reaction Plugin Test</title>
    <style>
      body {
        font-family:
          -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
        background: #f5f5f5;
      }
      h1,
      h2 {
        color: #333;
      }
      .test-section {
        background: white;
        padding: 1.5rem;
        margin: 1rem 0;
        border-radius: 8px;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }
      code {
        background: #f0f0f0;
        padding: 0.2em 0.4em;
        border-radius: 3px;
        font-family: 'Courier New', monospace;
      }
    </style>
  </head>
  <body>
    <h1>üß™ Chemical Reaction Plugin Test</h1>

    <div class="test-section">
      <h2>Test 1: Simple Reaction</h2>
      <p>Allyl bromide + Sodium iodide ‚Üí Allyl iodide + Sodium bromide</p>
      <div
        class="reaction-container"
        style="display: block; margin: 1em 0; text-align: center; overflow-x: auto"
      >
        <svg
          id="reaction-1"
          data-smiles="C=CCBr.[Na+].[I-]>CC(=O)C>C=CCI.[Na+].[Br-]"
          style="max-width: 100%; height: auto"
        ></svg>
        <p style="font-size: 0.85em; color: #666; margin: 0.5em 0">
          <code>C=CCBr.[Na+].[I-]>CC(=O)C>C=CCI.[Na+].[Br-]</code>
        </p>
      </div>
    </div>

    <div class="test-section">
      <h2>Test 2: Reaction with Text Below Arrow</h2>
      <p>Same reaction with "90%" displayed below the arrow</p>
      <div
        class="reaction-container"
        style="display: block; margin: 1em 0; text-align: center; overflow-x: auto"
      >
        <svg
          id="reaction-2"
          data-smiles="C=CCBr.[Na+].[I-]>CC(=O)C>C=CCI.[Na+].[Br-]"
          data-smiles-options='{"textBelowArrow":"90%"}'
          style="max-width: 100%; height: auto"
        ></svg>
        <p style="font-size: 0.85em; color: #666; margin: 0.5em 0">
          <code>C=CCBr.[Na+].[I-]>CC(=O)C>C=CCI.[Na+].[Br-]</code> with textBelowArrow: "90%"
        </p>
      </div>
    </div>

    <div class="test-section">
      <h2>Test 3: Esterification Reaction</h2>
      <p>Acetic acid + Ethanol ‚Üí Ethyl acetate + Water</p>
      <div
        class="reaction-container"
        style="display: block; margin: 1em 0; text-align: center; overflow-x: auto"
      >
        <svg
          id="reaction-3"
          data-smiles="CC(=O)O.CCO>H2SO4>CC(=O)OCC.O"
          data-smiles-options='{"textBelowArrow":"Heat"}'
          style="max-width: 100%; height: auto"
        ></svg>
        <p style="font-size: 0.85em; color: #666; margin: 0.5em 0">
          <code>CC(=O)O.CCO>H2SO4>CC(=O)OCC.O</code> with textBelowArrow: "Heat"
        </p>
      </div>
    </div>

    <div class="test-section">
      <h2>Test 4: Oxidation Reaction</h2>
      <p>1-Propanol oxidation to propanoic acid</p>
      <div
        class="reaction-container"
        style="display: block; margin: 1em 0; text-align: center; overflow-x: auto"
      >
        <svg
          id="reaction-4"
          data-smiles="CCCO.[O]>CrO3>CCC(=O)O"
          style="max-width: 100%; height: auto"
        ></svg>
        <p style="font-size: 0.85em; color: #666; margin: 0.5em 0">
          <code>CCCO.[O]>CrO3>CCC(=O)O</code>
        </p>
      </div>
    </div>

    <div class="test-section">
      <h2>Test 5: Oldschool Theme</h2>
      <p>Using the "oldschool" rendering theme</p>
      <div
        class="reaction-container"
        style="display: block; margin: 1em 0; text-align: center; overflow-x: auto"
      >
        <svg
          id="reaction-5"
          data-smiles="C=CCBr.[Na+].[I-]>CC(=O)C>C=CCI.[Na+].[Br-]"
          data-smiles-options='{"theme":"oldschool","textBelowArrow":"90%"}'
          style="max-width: 100%; height: auto"
        ></svg>
        <p style="font-size: 0.85em; color: #666; margin: 0.5em 0">
          <code>C=CCBr.[Na+].[I-]>CC(=O)C>C=CCI.[Na+].[Br-]</code> with theme: "oldschool"
        </p>
      </div>
    </div>

    <!-- Load SmilesDrawer library -->
    <script src="https://unpkg.com/smiles-drawer@2.0.1/dist/smiles-drawer.min.js"></script>

    <!-- Global rendering script -->
    <script>
      console.log('SmilesDrawer loaded:', typeof SmilesDrawer !== 'undefined');

      // Wait for DOM to be ready
      document.addEventListener('DOMContentLoaded', function () {
        console.log('DOM ready, rendering reactions...');

        // Find all SVG elements with data-smiles attribute
        const svgElements = document.querySelectorAll('svg[data-smiles]');
        console.log('Found', svgElements.length, 'reaction elements to render');

        svgElements.forEach(function (svg, index) {
          const smiles = svg.dataset.smiles;
          console.log('Rendering reaction', index + 1, ':', smiles);

          // Get custom options if provided
          let options = { width: 800, height: 400 };
          if (svg.dataset.smilesOptions) {
            try {
              const customOpts = JSON.parse(svg.dataset.smilesOptions);
              options = Object.assign(options, customOpts);
              console.log('Using custom options:', customOpts);
            } catch (e) {
              console.warn('Failed to parse options for reaction', index + 1, ':', e);
            }
          }

          try {
            const drawer = new SmilesDrawer.Drawer(options);
            SmilesDrawer.parse(
              smiles,
              function (tree) {
                drawer.draw(tree, svg, 'light', false);
                console.log('‚úÖ Successfully rendered reaction', index + 1);
              },
              function (error) {
                console.error('‚ùå Error parsing SMILES for reaction', index + 1, ':', error);
                svg.innerHTML =
                  '<text x="10" y="20" fill="#d00" font-size="14">Invalid Reaction SMILES: ' +
                  error +
                  '</text>';
              }
            );
          } catch (e) {
            console.error('‚ùå Error rendering reaction', index + 1, ':', e);
            svg.innerHTML = '<text x="10" y="20" fill="#d00" font-size="14">Rendering Error</text>';
          }
        });
      });
    </script>
  </body>
</html>
